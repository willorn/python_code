# 第一章 计算机组成

## 1.1 计算机的种子

> Q：
>
> 易经中的推理是什么？计算机体系中的逻辑推理又是什么？
>
> 计算机的seed是什么？是谁如何机缘巧合之下想出来这么巧妙的东西？又是在怎样的必然性和偶然性之下出现了？
>
> 计算机这东西里面是什么？结构是啥？
>
> 计算机的发展历程是什么？最开始的雏形？
>
> 在这个系列的最后，我们要清晰程序是如何被CPU调度执行的？

### 推理逻辑：

物有本末，事有终始，知其先后则近道矣

**修仙**：以仙气来修炼成长路线——《永生》

**游戏**：以新手教程和装备一步一步闯关，升级转职——《时空猎人》

**混沌**：先启蒙，先求道而后求术——《代码之道》



### 计算机历史

> 首先，一张图来看看CPU之下是什么？

![image-20230204101550971](https://q-1306233034.cos.ap-guangzhou.myqcloud.com/company/202302041015375.png?tximg)

#### 图灵机模型

**一切缘起：图灵机（Turing machine）**

**seed**：需要一种能够帮助人工作的机器，给到输入能够做出对应的输出

**图灵机**：从0到1

【什么是图灵机】https://www.bilibili.com/video/BV1br4y1N762

> 因为这其实就是模拟人类大脑的运算思路而制定的，比如说当人类思考3+4的时候会以一种什么样的思路去思考呢？什么样的思考方法可以使得任意大小的两个数都可以以相同的方法被计算出来呢？从这里面可以看出来，当经过两群1中间的0的时候，读写头的模式被更新成q2，而再经过一个0的时候读写头的模式会被更新成q3从而保持不动，而从q1变到q2再变到q3这个过程需要的步数便是这个过程中1的数量，由此可以进行任意大小两个数的加法计算。而且我可以根据数据的不同来制定不同的代码表从而实现不同的功能。比如说如果两个数中间有两个0，比如说三个数相加比如说两个数相乘，理论来讲都可以利用这种方法来进行模拟。而且图灵在之后证明了所有可以用算法解决的事情，或者说叫做可计算内容都可以用图灵机进行计算，方法是证明了图灵机的运作模式和之前被证明可以定义可计算问题的方法等价。而图灵的这种方法并不需要进行随机应变，只需要按照一个既定的程序读取一段既定的代码，就可以把所有可计算问题全部计算出来。
>
> 所以说并不是因为这个方法本身有多巧妙，而是因为这个方法可以计算的内容就是现有定义下的所有可计算内容，因此才是一个划时代意义的东西。这就意味着，我们可以借助程序来计算所有可以计算的问题，而不用担心人脑计算中可能会出现的错误，前提是程序书写恰当。



#### 冯诺依曼体系

> 冯诺依曼(1946)是计算机科学的先驱，他的主要思想是建立一种用于计算的通用机器。他提出了冯诺依曼体系结构，这是现代计算机体系结构的基础。

**思想概述**：冯诺依曼认为计算机应该是一个通用设备，可以通过使用一种通用的机器语言来编程。这种语言允许程序员以一种简单的方式编写代码，然后让计算机翻译成内部语言，从而实现计算。这一思想在当今仍然被广泛使用，并且是计算机科学领域的基础。这一思想对计算机科学的发展产生了深远的影响。

**计算机组成**：他定义了冯诺依曼体系，冯诺依曼体系是一种计算机结构，由以下几个组成部分组成，通过组装这些组件，就能够实现计算机的通用性和可编程性，从而提高计算机的功能和效率。

1. CPU（中央处理器）：负责执行计算机程序。
2. 存储器（内存）：用于存储程序和数据。
3. 输入设备（例如键盘、鼠标）：用于向计算机输入数据。
4. 输出设备（例如显示器、打印机）：用于从计算机输出数据。
5. 系统总线：连接各个组件，传输数据和控制信号。

他提出了程序可移植性的概念：使用通用语言编写代码，这表示程序员可以在任何使用冯诺依曼体系的计算机上运行代码，而不必担心底层硬件的差异。这个通用语言就是机器代码01，因为它可以以01表示有无，再加上与人类的符号系统联系，我们就可以推理得出：通过最简单的01衍生出可以描述世间任何事物的语言。通过01，可以构建所有的信息。

冯诺依曼体系的概念十分重要，它提出了使用通用语言编写代码的方法，以便计算机能够识别和处理数据。这一思想为后来的信息处理技术奠定了基础，并对后来的信息学研究产生了深远的影响。例如，通过使用冯诺依曼体系，我们可以对信息进行编码、存储、处理、传输和解码，实现了信息的高效处理。

总之，冯诺依曼体系是计算机科学史上一个重要的里程碑，对于计算机的发展产生了深远的影响。



> 看完了冯诺依曼，我们知道了01就是通用语言，我们可以用1，0组成万物，表示所有信息。

而对这些最基本的信息原子，可以使用运算器、控制器、存储器、IO来完成工作。这些计算机的硬件我们现在都耳熟能详，而研究他们，最重要的核心还是运算单元：CPU。

#### 计算机体系

> **计算机体系**：指由计算机的硬件和软件组成的系统。

硬件是指计算机的物理部件，如中央处理器（CPU）、内存（RAM）、存储设备（硬盘或闪存）等。

软件是指运行在计算机上的程序，包括操作系统、应用软件等。计算机体系是完成各种任务的基础，如计算数学公式、存储和处理数据、连接网络等。



**研究内容**

研究计算机体系结构我们需要重点关注的几项：**低功耗、高性能和小单位**，因为它们是影响计算机系统性能和效率的重要因素。

- 低功耗：减少计算机系统功耗可以降低成本并延长使用寿命。

- 高性能：计算机系统能够快速处理大量数据，从而实现快速和准确的计算。

- 小单位：计算机系统的结构尽可能紧凑，从而使系统更容易携带和维护。

其他因素，例如：稳定性、可靠性、易用性、安全性、成本等。



#### 数字逻辑

数字逻辑是一门计算机科学领域的学科，主要研究如何使用数学方法和模型来设计、分析和理解计算机系统中的逻辑电路。它涵盖了计算机硬件和软件的数学模型，以及数学逻辑、代数、图论、概率论、信息理论等相关领域的知识。数字逻辑的目的是提供一种通用的方法来研究和设计数字电路，以提高计算机系统的效率和可靠性。

我们不需要关注那么多，我们只需要了解即可。基础概念：电压电流的高低电平、晶体管、逻辑门、锁存器。

**晶体管**：

很有意思，它可以利用半导体材料的特殊特性，将小电流转换为大电流。它通过控制电流流动，来改变输出电压。晶体管有三个端，分别是发射极（emitter）、基极（base）和收集极（collector）。通过对这三个端的控制，可以实现对电流的控制。晶体管可以执行电路中的开关和控制功能，如放大、切换、触发等。

**逻辑门**：

逻辑门是计算机中最基本的逻辑单元，用于执行简单的逻辑运算。它们以输入信号为基础，生成输出信号。逻辑门通常是用电学元器件（如晶体管）实现的。常见的逻辑门有：与门（AND gate）、或门（OR gate）、非门（NOT gate）、异或门（XOR gate）等。每个逻辑门都有一组定义其逻辑关系的规则，并对输入信号进行简单的逻辑运算，从而产生输出信号。

逻辑门的原理是基于电学，利用二极管和晶体管实现逻辑运算。逻辑门的操作是基于电学信号在其中传输和转换的过程，因此它们能够快速、稳定地处理信息。

**锁存器**：

锁存器（Flip-Flop）是一种存储单元，它可以存储二进制信息，通常是一位数据。

它通过控制电路实现数据存储，原理是通过两个输入信号（通常是控制信号）来控制其状态的转换，这些状态通常是 "1" 和 "0"，而这些数据是存储在内部的晶体管中的，当控制电路接通时，数据就被锁存下来，并可以在以后读取。

锁存器的状态可以用于控制计算机系统中的各种元件，例如寄存器、移位寄存器、多位寄存器等。





#### 计算机硬件

> CPU、存储（内存、硬盘）、外设（输入输出设备、电源）
>
> 冯诺依曼体系（定义了硬件） + 物理（电学）+ 数论（逻辑） = 计算机硬件

**硬件发展史**：

计算机硬件的发展历史可以追溯到 20 世纪初，当时的计算机通常由大型、繁琐的机械组件组成，如分别用于存储数据和指令的机械式磁铁和纸带。随着电子技术的发展，计算机硬件开始向数字方向发展，并逐渐由电子元器件取代机械元器件。

1940 年代，第一台用电子元器件组成的数字计算机诞生了，这是第一台真正意义上的电子计算机。随后，随着集成电路的出现，计算机硬件进一步小型化和简化，并逐渐普及到家庭和办公室。

1980 年代，个人计算机（PC）开始普及，并为计算机硬件的进一步发展提供了平台。随着微处理器技术的不断提高，计算机性能得到了显著提高，并为智能手机和平板电脑的诞生创造了条件。

现今，计算机硬件不断地演进和提高，新技术和元器件的不断涌现，如云计算、人工智能等，为计算机科学和技术的发展带来了新的机遇和挑战。







### **推荐资料**

> Tip：推荐看书，作者的话，前言（前提是翻译好才能看下去）
>

- 《计算机组成原理》
- 《模拟电⼦技术基础(第五版)》
- 《数字电子技术》





## 1.2 汇编语言出现

> 本节课讲了：数据**存哪里 + 怎么存**
>
> 为什么是二进制、RAM与ROM、计算机组成原理
>
> **攻乎异端，斯害也已**：但只要我们都向着正确的地方走，终会有一天大家都能汇聚在一起。
>
> 任何事物都有其发展的道，而每个人的道都不一样，但是道一直存在。每个人的道就是自己原本的宿命，圣人的宿命与小偷的宿命都是宿命，如果不能深刻认识自己，一直保持随波逐流，只能说命运永远都只是把握在别人的手中的。只有深刻认识自身，才能思变。突破困苦人生的掣肘。
>
> 任何纷繁复杂的事物都是由最简单的事物演化而来的，从根部到参天大树，都是不断演进不断前行生出来的。



### 计算机组成原理讲解

《计算机组成原理》前言

> 21世纪是科学和技术奇迹频出的时代。计算机已经做到了人们期望它做到的一切——甚至更多。生物工程解开了细胞的秘密，使科学家能够合成10年前无法想象的新药。纳米技术让人们有机会窥探微观世界，将计算机革命与原子工程结合在一起创造出的纳米机器人，也许有一天能够植入人体，修复人体内部的创伤。普适计算带来了手机、MP3播放器和数码相机，使人们彼此之间能够通过Internet保持联系。计算机是几乎所有现代技术的核心。本书将阐述计算机是如何工作的。
>  从20世纪50年代起大学就开始教授这门被称为计算的学科了。一开始，大型机主导了计算，这个学科包括对计算机本身、控制计算机的操作系统、语言和它们的编译器、数据库以及商业计算等的研究。此后，计算的发展呈指数增长，到现在已包含多个不同的领域，任何一所大学都不可能完全覆盖这些领域。人们不得不将注意力集中在计算的基本要素上。**这一学科的核心在于机器本身：计算机**。当然，作为一个理论概念，计算可以脱离计算机而独立存在。实际上，在20世纪三四十年代计算机革命开始之前，人们已经进行了相当多的关于计算机的科学理论基础的研究工作。然而，**计算在过去40年里的发展方式与微处理器的崛起紧密联系在一起**。如果人们无法拥有价格非常便宜的计算机，Internet也无法按照它已有的轨迹取得成功。
>  由于计算机本身对计算的发展及其发展方向产生了巨大影响，在计算的课程体系中包含一门有关计算机如何工作的课程是非常合理的。大学里计算机科学或计算机工程方向的培养方案中都会有这样一门课程。实际上，专业和课程的认证机构都将计算机体系结构作为一项核心要求。比如，计算机体系结构就是IEEE 计算机协会和ACM联合发布的计算学科课程体系的中心内容。
>  介绍计算机具体体现与实现的课程有各种各样的名字。有人将它们叫作硬件课，有人管它们叫作**计算机体系结构**，还有人把它们叫作**计算机组成（以及它们之间的各种组合）**。本书用计算机体系结构表示这门研究计算机设计方法和运行方式的课程。当然，我会解释为什么这门课程有那么多不同的名字，并会指出可以用不同的方式来看待计算机。
>  与计算机科学的所有领域一样，计算机体系结构也随着指令集设计、指令级并行（ILP）、Cache缓存技术、总线系统、猜测执行、多核计算等技术的发展而飞速进步。本书将讨论所有这些话题。
>  计算机体系结构是计算机科学的基石。例如，计算机性能在今天的重要性超过了以往任何时候，为了做出最佳选择，即便是那些购买个人电脑的用户也必须了解计算机系统的结构。
>  尽管绝大多数学生永远不会设计一台新的计算机，但今天的学生却需要比他们的前辈更全面地了解计算机。虽然学生们不必是合格的汇编语言程序员，但他们一定要理解总线、接口、Cache和指令系统是如何决定计算机系统的性能的。



#### 为什么是二进制？

从易经的思想可以看到，一为太极初始，二为阴阳，即男女雄雌，阴阳所生为三，就是后代，无数万物结合就构建出了万物。



电气特性限制科技发展，所以只能为二进制

计算机硬件、操作系统软件、语言、机器语言、编译器、数据库

理论基础-嵌入式开发（微处理器）

计算机组成-计算机体系结构（图灵机的实现）

1248原则

只有基础至上，在开始接触的时候基础足够牢固，以后接触到更多事物的时候才不会感觉到吃力。人往往在接触到一个事物之后就会不断探索，好奇心驱使着人们不停往下走，这就是学习动力的一种。

诸葛大力：不是我不懂，是我还没有学

CSAPP

布尔代数？离散数学：用哪里就看哪里



#### 信息的传递介质

人脑：电位差（编码，转换）

亿级流量，多级缓存（l1,l2,l3）MySQL、redis





#### 推理：如何操作硬件

**推理过程**：

##### 1、如何操控硬件?

<img src="https://q-1306233034.cos.ap-guangzhou.myqcloud.com/company/202302041649892.png?tximg" alt="image-20230204164942482" style="zoom: 80%;" />

写指令操作硬件需要依赖于具体的硬件和操作系统，下面是一些通用的步骤(注意：硬件的操作可能具有危险性，请确保在操作前了解相关警告和安全措施。)：

1. 了解操作系统支持的编程语言，例如 C、C++、Java、Python 等。
2. 了解硬件的接口和通信协议，如 I2C、SPI、UART 等。
3. 根据操作系统和语言的文档，写出控制硬件的代码。
4. 运行代码，测试硬件是否按预期工作。
5. 根据测试结果，不断调整代码，直到硬件能按预期工作为止。

从图中可以看到，写指令操作硬件的方式因硬件类型和操作系统而异。通常情况下，需要使用特定的编程语言（如 C，C++，Python）和相应的库（如 WinAPI，libusb，libSerial）来编写代码。



##### 2、代码是如何控制硬件的？

<img src="https://q-1306233034.cos.ap-guangzhou.myqcloud.com/company/202302042141738.png?tximg" alt="image-20230204165527923" style="zoom:67%;" />

因为CPU是控制器，所以控制计算机就是通过 01 组成的指令去控制CPU，而这些指令则是由硬件厂商规定，硬件厂商通常会提供一些接口（例如 USB、I2C、SPI 等），使 CPU 可以与硬件进行通信。通过写代码来使用这些接口，CPU 就可以控制硬件（BS模型）。

例如，通过向 GPU 发送命令，可以控制图形处理器进行图形渲染；通过向网卡发送命令，可以控制它接收和发送网络数据。所以 CPU 可以作为一个中心来控制其他硬件的工作。

但我们并不会直接写ISA指令，因为太复杂了。。。

影响代码的可读性，稳定性，，维护性也很差。可以预见编写ISA代码会有很大的困难，不利于开发。所以就有了 **汇编语言** 与 **汇编器**。

![image-20230204165932085](https://q-1306233034.cos.ap-guangzhou.myqcloud.com/company/202302041659858.png?tximg)



##### 3、代码是存哪里？

程序代码通常存储在硬盘上，做持久化存储。当程序运行时，它的代码会被加载到计算机的内存（RAM）中，然后 CPU 会读取并执行这些指令。存储在硬盘上的代码可以通过文件管理器或命令行工具检索和编辑。

为什么这样设计？

1、假设不存在RAM，代码的执行只能通过磁盘进行交互。ROM是只读存储，而数据是需要存取，那么必然不能为程序开辟空间，则不能够实现这样的设计。

2、因为我们的代码文件是read only的，而数据是需要存取的，所以硬件条件较为苛刻的情况下，如微小型的设备，我们就可以使用 ROM 存储代码，只用少量的RAM 存储运行时需要更新更改的 数据即可（RAM比ROM成本高）

3、为什么不使用大缓存？成本问题

4、本质：CPU的处理速度 大幅度的超过了 磁盘 的IO速度，如果都从里面读写，就会导致CPU大部分时间处于等待中。所以我们给计算机增加了缓存，缓存是用于适配CPU的处理速度的，代码和数据加载到 RAM 中以便 CPU 可以快速访问和执行它们。于是我们就添加缓存 ，首先是RAM， 但是RAM还是很慢，在CPU 中嵌入 缓存（多级缓存技术）。



<img src="https://q-1306233034.cos.ap-guangzhou.myqcloud.com/company/202302042141739.png?tximg" alt="image-20230204172608669" style="zoom:67%;" />



**补充**：RAM与ROM

> RAM+ROM = 嵌入式、微型处理器
>
> 类比于：运算+代码 = 可用的程序

**RAM**随机存储器（random access memory）

是指随机存取存储器（random access memory，RAM）又称作“随机存储器”，是与CPU直接交换数据的内部存储器，也叫主存(内存)。

**ROM**只读存储器（Read-Only Memory）

以非破坏性读出方式工作，只能读出无法写入信息。信息一旦写入后就固定下来，即使切断电源，信息也不会丢失。



##### 4、推理得出：

过程：

1. 我们通过键盘，输入人类懂得的编程语言（C、Python、Java），经过特定的编译器进行编译后得到汇编语言
2. 汇编语言经过编译器转换为ISA指令集，指令集传输到CPU中
3. CPU对ISA指令进行解析，根据单个指令（ADD、MOV）对寄存器进行CRUD。
4. 控制硬件，得到反馈。



### **推荐资料**

- 《计算机组成原理》
- 《大话计算机》
- 《CSAPP》，这本书集大成



## 1.3 汇编到ISA

> **汇编世界的基本单元：8个字节**
>
> **汇编就是和ISA指令的一一对应**

### ISA指令集推理

> 本节讲了：
>
> CPU作为计算机的处理器，是用于控制和运算的
> 作为处理器的本身，自己有控制单元、运算单元、寄存单元（存储器）
>
> 操作CPU的语言叫做ISA指令，ISA指令让CPU执行各种操作
>
> ISA指令的由来是汇编语言，由汇编器生成



### 汇编语言的本质

汇编语言：操作CPU控制其他硬件控制输入输出



看了两本书的前言

1. 《计算机组成 与 汇编》
   为何汇编 会 扯到 计算机组成 ？？？？
   汇编语言是面向指令集的，而指令集又是计算机硬件厂商提供的，计算机的硬件是 计算机组成和计算机体系结构 共同研究的内容，所以 汇编 书籍中也存在一些章节是讲计算机组成、计算机体系结构的！
2. 《汇编语言 基于x86处理器》



有了汇编以后，我们可以更好的编写程序了，但是这样就够了嘛？很显然是不够的，因为还是不够贴近自然语言，所以高级语言就有了 ---> C、Python、Java、Go……



高级语言屏蔽了CPU的底层处理，更符合人类的思维习惯。



编码：将一个信息根据某种规则转变为另外一种信息





总结：

 CPU的内部结构由控制单元，运算单元，存储单元也就是寄存器这三个主要单元组成的。而CPU里面的缓存并不是它的主要的组成单元，因为缓存的速度跟CPU里面三个主要的单元速度是不匹配的。
我们单看CPU本身，CPU本身就有着很完整的内存结构，但是我们将CPU玩小了看，我们就可以看到CPU外面的世界。CPU在计算机里面只是充当着控制器以及运算器，存储功能主要放在内存rom和RAM中。CPU在外部只是小小的控制器和运算器。
这里再讲一下CPU充当控制器和运算器的工作原理。当CPU充当着控制器和运算器时，CPU拿到用户给到CPU的机器码，这个CPU机器码呢是isa指令集中的编码，CPU拿到这个指令集中的机器码之后，开始正式工作。这些指令进入到CPU中的控制单元，控制单元开始将寄存器中的数据加载出来，交给运算器去对数据进行操作运算，当操作运算完成了之后，控制器在将数据从寄存器中取出，再放置在寄存器中，然后再输出到外部内存（主存中）。
指令集就是一种编码规则，编码规范。
编码就是将一个信息通过某种特定的规则转换为另外一种信息，转换前后他们的本质上依然是信息。

### C语言出现推理



### 推荐资料

- 《汇编语言：基于x86处理器》
- 《计算机组成及汇编语言原理》





## 小结

**冯诺依曼到计算机的诞生**

图灵：计算机能够帮助人类解决问题

冯诺依曼：定义了计算机的组成，并决定了后续计算机体系的发展方向：体系结构-更优的体系

电路原理：如何组成基本电路

数字逻辑：硬件：晶体管-逻辑门-触发器-锁存器  抽象：电路逻辑

计算机硬件：CPU、内存、硬盘、外设



**计算机语言的发展过程**

计算机语言的发展历史可以追溯到计算机诞生之初。当时，计算机的程序是用机器语言编写的，机器语言是一种低级的语言，其中的指令是直接用二进制代码表示的。随着计算机硬件的发展，编写程序变得越来越困难，于是汇编语言应运而生。汇编语言是一种高级的语言，其中的指令是用符号和简短的字符代码表示的，是机器语言的一种抽象。

随着计算机科学的不断发展，高级语言如C、Java等逐渐普及，并成为计算机程序开发的主要语言，汇编语言逐渐被替代。但是，汇编语言仍然对于研究计算机体系结构和低级程序设计等领域具有重要的价值。








